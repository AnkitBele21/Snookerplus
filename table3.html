<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Live Scoreboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0b0b0b;
      color: white;
      text-align: center;
    }
    .scoreboard {
      margin-top: 50px;
      font-size: 24px;
    }
    .players {
      display: flex;
      justify-content: space-around;
      margin: 20px;
    }
    .player {
      flex: 1;
    }
    .message {
      margin-top: 30px;
      font-size: 20px;
      color: #00ff95;
    }
  </style>
</head>
<body>
  <div class="scoreboard">
    <div class="players">
      <div class="player">
        <h2 id="player1Name">Player 1</h2>
        <h1 id="player1Score">0</h1>
      </div>
      <div class="player">
        <h2 id="player2Name">Player 2</h2>
        <h1 id="player2Score">0</h1>
      </div>
    </div>
    <div class="message" id="message"></div>
  </div>

  <script>
    const sheetId = "1FD4unKr6u9fLOjeOVdtzgrDcw6cUWuyjJFQVBaQRoaI";
    const sheetName = "table3";
    const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${sheetName}`;

    async function fetchSheetData() {
      try {
        const response = await fetch(url);
        const text = await response.text();

        const json = JSON.parse(text.substr(47).slice(0, -2));
        const rows = json.table.rows;
        const headers = json.table.cols.map(col => col.label);

        if (!rows[0]) {
          console.error("No data found.");
          return;
        }

        const values = rows[0].c.map(cell => (cell ? cell.v : ""));
        const data = {};
        headers.forEach((key, i) => {
          data[key] = values[i] || "";
        });

        console.log("Fetched data:", data);

        // Update DOM safely
        document.getElementById('player1Name').innerText = data.player1Name || "Player 1";
        document.getElementById('player1Score').innerText = data.player1Score || "0";
        document.getElementById('player2Name').innerText = data.player2Name || "Player 2";
        document.getElementById('player2Score').innerText = data.player2Score || "0";
        document.getElementById('message').innerText = data.message || "";

      } catch (error) {
        console.error("Error fetching data:", error);
      }
    }

    // Refresh every 3 seconds
    fetchSheetData();
    setInterval(fetchSheetData, 3000);
  </script>
</body>
</html>
